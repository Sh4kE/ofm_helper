{% extends "core/base.html" %}

{% block content %}

    {% load staticfiles %}

    <h1 class="page-header">Deine Stadionstatistik</h1>

    <div id="table-toolbar">
        <div class="form-inline" role="form">
            <div class="form-group">
                <label id="expert-mode-toggle-label" for="expert-mode-toggle">Expertenmodus: </label>
                <input id="expert-mode-toggle" name="expert-mode-toggle" type="checkbox" data-on-text="An" data-off-text="Aus" data-on-color="success" data-size="small">

                <label id="strength-slider-label" for="strength-slider" data-toggle="tooltip" data-placement="top" title="">Stärke: </label>
                <input id="strength-slider" type="text"/>

                <label id="tolerance-slider-label" for="tolerance-slider" data-toggle="tooltip" data-placement="top" title="Toleranzwert für die Suche">Toleranz: </label>
                <input id="tolerance-slider" type="text"/>
            </div>
        </div>
    </div>

    <table id='stadium_statistics_table' class="table table-bordered table-striped table-hover statistics_table"
           data-toolbar="#table-toolbar"
           data-toggle="table"
           data-search="true"
           data-show-refresh="true"
           data-show-columns="true"
           data-query-params="queryParams"
           data-url="{% url 'core:ofm:stadium_statistics_overview_json' %}">
        <thead id="stadium_statistics_table_head">
            <tr>
                <th data-field="matchday" data-sortable="true"><span class="glyphicon glyphicon-calendar"></span></th>
                <th data-field="capacity" data-sortable="true" data-formatter="numberFormatter"><span class="flaticon-football-fan-with-facepaint"></span> Kapazität</th>
                <th data-field="visitors" data-sortable="true" data-formatter="numberFormatter"><span class="flaticon-football-fan-with-facepaint"></span> Zuschauer</th>
                <th data-field="workload" data-sortable="true"><span class="flaticon-football-fan-with-facepaint"></span> Auslastung</th>
                <th data-field="home_strength" data-sortable="true"><span class="glyphicon glyphicon-home"></span> Stärke</th>
                <th data-field="guest_strength" data-sortable="true"><img src="{% static 'core/img/bus.svg' %}" height="16px"/> Stärke</th>
                <th data-field="harmonic_strength" data-sortable="true" data-formatter="numberFormatter" title="Harmonisches Mittel der Mannschaftsstärken">Gemittelte Stärke</th>
                <th data-field="earnings" data-sortable="true" data-formatter="numberFormatter"><span class="glyphicon glyphicon-euro"></span> Einnahmen</th>
                <th data-field="light_level" data-sortable="true" data-visible="false"><span class="flaticon-football-court-illumination-lamps"></span> Flutlicht</th>
                <th data-field="security_level" data-sortable="true" data-visible="false"><span class="flaticon-football-badge"></span> Sicherheit</th>
                <th data-field="screen_level" data-sortable="true" data-visible="false"><span class="flaticon-football-game-on-tv"></span> Anzeigetafel</th>
                <th data-field="parking_level" data-sortable="true" data-visible="false"><img src="{% static 'core/img/parking.svg' %}" height="16px"/> Parkplätze</th>
            </tr>
        </thead>
    </table>

    <script>
        var JSON_URL = '{% url 'core:ofm:stadium_statistics_overview_json' %}';
        var $tables = $('.statistics_table')

        $(function () {
          $('[data-toggle="tooltip"]').tooltip()
        });

        $('#expert-mode-toggle').bootstrapSwitch('state', false);

        $('#expert-mode-toggle').on('switchChange.bootstrapSwitch', function (event, data) {
            var params = {};

            if (data) {
                $("#strength-slider-label").html('Gemittelte Stärke');
                $("#strength-slider-label").attr('title', "Harmonisches Mittel der Mannschaftsstärken");
                $("#strength-slider-label").attr('data-original-title', "Harmonisches Mittel der Mannschaftsstärken");

                console.log(data);
                console.log("hallo");

                // prequery the database once to get min and max values?
                $("#strength-slider").slider({  min: 0, max: 400, value: [50, 100], labelledby: 'strength-slider-label'});
                $("#tolerance-slider").slider({  min: 0, max: 100, value: 50, labelledby: 'tolerance-slider-label'});

                params = {

                };
            } else {
                $("#strength-slider-label").html('Stärke');
                $("#strength-slider-label").attr('title', "");
                $("#strength-slider-label").attr('data-original-title', "");

                // prequery the database once to get min and max values?
                $("#strength-slider").slider({  min: 0, max: 400, value: 200, labelledby: 'strength-slider-label'});
                $("#tolerance-slider").slider({  min: 0, max: 100, value: 50, labelledby: 'tolerance-slider-label'});

                params = {

                };
            }

            $.get(JSON_URL, params, function (returnedData) {
                    $tables.bootstrapTable('removeAll');
                    $tables.bootstrapTable('load', returnedData);
                }
            );
        });

        $('#strength-slider').slider().on('slideStop', function(event){
            console.log('now query the json backend and update the table please');
            console.log(event.value);
        });

        $('#tolerance-slider').slider().on('slideStop', function(event){
            console.log('now query the json backend and update the table please');
            console.log(event.value);
        });


    </script>

    <script src="{% static 'core/js/table_formats.js' %}"></script>

{% endblock %}
